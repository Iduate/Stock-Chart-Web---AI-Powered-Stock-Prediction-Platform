Write-Host "Starting translation compilation..."

# Add gettext tools to PATH
$env:Path += ";C:\Program Files\gettext-iconv\bin"

# Get current directory
$projectDir = (Get-Location).Path
Write-Host "Current directory: $projectDir"

# Create a clean .po file with no duplicates
$cleanPoContent = @'
# Korean translations for Stock Chart Web
# Generated by Django

msgid ""
msgstr ""
"Content-Type: text/plain; charset=UTF-8\n"
"Language: ko\n"
"Project-Id-Version: Stock Chart Web\n"
"Report-Msgid-Bugs-To: \n"
"POT-Creation-Date: 2025-08-30 11:30+0000\n"
"PO-Revision-Date: 2025-08-30 11:30+0000\n"
"Last-Translator: Auto Generated\n"
"Language-Team: Korean\n"
"MIME-Version: 1.0\n"
"Content-Transfer-Encoding: 8bit\n"
"Plural-Forms: nplurals=1; plural=0;\n"

msgid "Stock Chart Web - Predict & Profit"
msgstr "주식 차트 웹 - 예측하고 수익을"

# Navigation
msgid "Home"
msgstr "홈"

msgid "Chart Board"
msgstr "차트 보드"

msgid "My Predictions"
msgstr "내 예측"

msgid "Charts"
msgstr "차트"

msgid "Predictions"
msgstr "예측"

msgid "Leaderboard"
msgstr "순위표"

msgid "Profile"
msgstr "프로필"

msgid "Login"
msgstr "로그인"

msgid "Register"
msgstr "회원가입"

msgid "Logout"
msgstr "로그아웃"

# Home page
msgid "Predict Stock Prices with AI"
msgstr "AI로 주식 가격 예측"

msgid "Join thousands of traders making accurate predictions and earning rewards in our AI-powered trading platform."
msgstr "AI 기반 거래 플랫폼에서 정확한 예측을 하고 보상을 받는 수천 명의 트레이더와 함께하세요."

msgid "Get Started Free"
msgstr "무료로 시작하기"

msgid "Sign In"
msgstr "로그인"

msgid "Start Trading"
msgstr "거래 시작"

msgid "My Profile"
msgstr "내 프로필"

msgid "Active Traders"
msgstr "활성 트레이더"

msgid "Predictions Made"
msgstr "예측 완료"

msgid "Average Accuracy"
msgstr "평균 정확도"

msgid "Rewards Paid"
msgstr "지급된 보상"

msgid "Trending Markets"
msgstr "인기 마켓"

msgid "Recent Predictions"
msgstr "최근 예측"

msgid "Why Choose Our Platform?"
msgstr "왜 우리 플랫폼을 선택해야 할까요?"

msgid "Advanced AI-powered predictions with real rewards"
msgstr "실제 보상이 있는 고급 AI 기반 예측"

msgid "AI-Powered Insights"
msgstr "AI 기반 인사이트"

msgid "Advanced machine learning algorithms analyze market patterns to help you make better predictions."
msgstr "고급 머신러닝 알고리즘이 시장 패턴을 분석하여 더 나은 예측을 할 수 있도록 도와줍니다."

msgid "Real Rewards"
msgstr "실제 보상"

msgid "Earn actual money for accurate predictions. Top performers receive cash prizes and bonuses."
msgstr "정확한 예측으로 실제 돈을 벌어보세요. 상위 성과자는 현금 상금과 보너스를 받습니다."

msgid "Social Trading"
msgstr "소셜 트레이딩"

msgid "Follow successful traders, share insights, and learn from the community's collective wisdom."
msgstr "성공한 거래자를 팔로우하고, 인사이트를 공유하며, 커뮤니티의 집단 지혜로부터 배우세요."

msgid "Professional Charts"
msgstr "전문가용 차트"

msgid "TradingView integration provides institutional-grade charting tools and technical indicators."
msgstr "TradingView 통합으로 기관급 차트 도구와 기술적 지표를 제공합니다."

msgid "Top Performers"
msgstr "최고 성과자"

msgid "Rankings"
msgstr "순위"

msgid "Contests"
msgstr "경연"

msgid "Real-time Market Analysis"
msgstr "실시간 시장 분석"

msgid "Professional-grade charts and AI insights"
msgstr "전문가급 차트와 AI 인사이트"

msgid "Loading market data..."
msgstr "시장 데이터 로딩 중..."

msgid "No market data available"
msgstr "사용 가능한 시장 데이터가 없습니다"

msgid "Failed to load market data. Please refresh the page."
msgstr "시장 데이터 로드에 실패했습니다. 페이지를 새로고침해주세요."

msgid "Authentication required to load market data"
msgstr "시장 데이터 로드를 위해 인증이 필요합니다"
'@

msgid "Failed to load market data. Please refresh the page."
msgstr "시장 데이터 로드에 실패했습니다. 페이지를 새로고침해주세요."

msgid "Authentication required to load market data"
msgstr "시장 데이터 로드를 위해 인증이 필요합니다"
"@

# Define paths for temp files
$tempPoFile = "C:\Temp\django_ko.po"
$moFile = "$projectDir\locale\ko\LC_MESSAGES\django.mo"

# Create temp dir if needed
if (-not (Test-Path "C:\Temp")) {
    New-Item -ItemType Directory -Path "C:\Temp" -Force | Out-Null
}

# Write clean content to temp file
Set-Content -Path $tempPoFile -Value $cleanPoContent -Encoding UTF8

Write-Host "Created clean translation file at: $tempPoFile"
Write-Host "Output MO file will be: $moFile"

# Make sure output directory exists
$outputDir = [System.IO.Path]::GetDirectoryName($moFile)
if (-not (Test-Path $outputDir)) {
    New-Item -ItemType Directory -Path $outputDir -Force | Out-Null
    Write-Host "Created output directory: $outputDir"
}

# Compile the translation
Write-Host "Compiling translation..."
& msgfmt -o $moFile $tempPoFile

# Check result
if ($LASTEXITCODE -eq 0) {
    Write-Host "Translation compiled successfully!" -ForegroundColor Green
} else {
    Write-Host "Error compiling translation. Exit code: $LASTEXITCODE" -ForegroundColor Red
}

# Clean up
if (Test-Path $tempPoFile) {
    Remove-Item -Path $tempPoFile -Force
    Write-Host "Temporary file cleaned up."
}

Write-Host "Done!"
